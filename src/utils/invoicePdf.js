import pdfMake from 'pdfmake/build/pdfmake';
import pdfFonts from 'pdfmake/build/vfs_fonts';
import { extractNumericValue } from '@/features/leads/utils/deviceUtils';
import { calculatePaymentDetails } from '@/features/leads/utils/deviceUtils';

// pdfmake fontlarni yuklash
try {
  if (pdfFonts && pdfFonts.pdfMake && pdfFonts.pdfMake.vfs) {
    pdfMake.vfs = pdfFonts.pdfMake.vfs;
  } else if (pdfFonts && pdfFonts.pdfMake) {
    pdfMake.vfs = pdfFonts.pdfMake.vfs;
  } else if (pdfFonts) {
    pdfMake.vfs = pdfFonts;
  } else if (typeof pdfFonts !== 'undefined') {
    pdfMake.vfs = pdfFonts;
  }
} catch (error) {
  console.warn('pdfmake fontlarni yuklashda xatolik:', error);
}

/**
 * Invoice ma'lumotlaridan PDF fayl yaratadi va yuklab olish
 * Shartnoma formatida - to'liq shablon asosida
 * Times New Roman font bilan, Cyrillic belgilarini qo'llab-quvvatlaydi
 * @param {Object} invoiceData - Invoice ma'lumotlari
 * @param {string} invoiceData.clientName - Mijoz nomi
 * @param {string} invoiceData.clientPhone - Mijoz telefon raqami
 * @param {string} invoiceData.cardCode - Card code
 * @param {string} invoiceData.leadId - Lead ID
 * @param {Array} invoiceData.DocumentLines - Qurilmalar ro'yxati
 */
/**
 * Rasmni base64 formatiga o'tkazadi
 * @param {string} imagePath - Rasm fayl yo'li
 * @returns {Promise<string>} Base64 string
 */
const imageToBase64 = async (imagePath) => {
  try {
    const response = await fetch(imagePath);
    const blob = await response.blob();
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  } catch (error) {
    console.error('Rasmni yuklashda xatolik:', error);
    return null;
  }
};

export const generateInvoicePdf = async (invoiceData) => {
  console.log('generateInvoicePdf chaqirildi, invoiceData:', invoiceData);
  
  if (!invoiceData) {
    throw new Error('invoiceData topilmadi');
  }
  
  const { 
    clientName, 
    clientPhone, 
    cardCode = invoiceData.CardCode,
    leadId, 
    jshshir = '',
    passportId = '',
    clientAddress = '',
    userSignature = null,
    DocumentLines = [],
    selectedDevices = []
  } = invoiceData;
  
  console.log('Invoice ma\'lumotlari:', { clientName, clientPhone, cardCode, leadId, DocumentLinesCount: DocumentLines.length, selectedDevicesCount: selectedDevices.length });

  try {
    // Imzo va muhur rasmini yuklab olish
    const signatureImage = await imageToBase64('/signature-stamp.jpg');
    
    // Jami narxni hisoblash
    const totalPrice = DocumentLines.reduce((sum, line) => sum + (line.Price || 0), 0);
    const totalPriceFormatted = totalPrice.toLocaleString('uz-UZ');

    // To'lov jadvali uchun ma'lumotlarni hisoblash
    const calculatePaymentSchedule = () => {
      if (!selectedDevices || selectedDevices.length === 0) {
        return [];
      }

      // Barcha qurilmalar uchun umumiy to'lov jadvalini yaratish
      const schedule = [];
      let maxPeriod = 0;
      const devicePayments = [];

      selectedDevices.forEach((device) => {
        const price = extractNumericValue(device.price);
        const period = Number(device.rentPeriod) || 0;
        const firstPayment = extractNumericValue(device.firstPayment) || 0;
        const monthlyPayment = extractNumericValue(device.monthlyPayment) || 0;
        
        if (price && period > 0) {
          maxPeriod = Math.max(maxPeriod, period);
          
          devicePayments.push({
            period,
            monthlyPayment,
            firstPayment,
            price,
          });
        }
      });

      // Har bir oy uchun to'lov miqdorini hisoblash
      let remainingAmount = totalPrice;
      
      for (let month = 1; month <= Math.max(maxPeriod, 15); month++) {
        let monthlyTotal = 0;
        
        // Har bir qurilma uchun oylik to'lovni qo'shamiz
        devicePayments.forEach((devicePayment) => {
          if (month <= devicePayment.period) {
            monthlyTotal += devicePayment.monthlyPayment;
          }
        });

        // Birinchi oyda birinchi to'lovni qo'shamiz
        if (month === 1) {
          devicePayments.forEach((devicePayment) => {
            monthlyTotal += devicePayment.firstPayment;
          });
        }

        remainingAmount -= monthlyTotal;

        // Sana hisoblash (keyingi oylar uchun)
        const paymentDate = new Date();
        paymentDate.setMonth(paymentDate.getMonth() + month - 1);
        const dateStr = paymentDate.toLocaleDateString('uz-UZ', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
        });

        schedule.push({
          number: month,
          date: dateStr,
          amount: Math.round(monthlyTotal),
          remaining: Math.max(0, Math.round(remainingAmount)),
        });
      }

      return schedule;
    };

    const paymentSchedule = calculatePaymentSchedule();

    // Sana
    const date = new Date();
    const day = date.getDate();
    const monthNames = ['январ', 'феврал', 'март', 'апрел', 'май', 'июн', 'июл', 'август', 'сентябр', 'октябр', 'ноябр', 'декабр'];
    const monthNamesRu = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
    const month = monthNames[date.getMonth()];
    const monthRu = monthNamesRu[date.getMonth()];
    const year = date.getFullYear();

    // IMEI ma'lumotlari
    const imei1 = DocumentLines[0]?.SerialNumbers?.[0]?.ManufacturerSerialNumber || '_______________________';
    const imei2 = DocumentLines[1]?.SerialNumbers?.[0]?.ManufacturerSerialNumber || '_______________________';
    // Telefon nomini olish - avval selectedDevices'dan, keyin DocumentLines'dan
    const itemName1 = selectedDevices[0]?.name || DocumentLines[0]?.ItemName || DocumentLines[0]?.ItemCode || '_______________________';
    const itemName2 = selectedDevices[1]?.name || DocumentLines[1]?.ItemName || DocumentLines[1]?.ItemCode || '_______________________';

    // PDF document definition
    const docDefinition = {
      pageSize: 'A4',
      pageMargins: [40, 40, 40, 40],
      defaultStyle: {
        font: 'Roboto',
        fontSize: 9,
        lineHeight: 1.2,
      },
      content: [
        // ========== SAHIFA 1: Sarlavha va kirish ==========
        {
          columns: [
            {
              width: '*',
              text: [
                { text: 'Муддатли тўлов асосида\n', fontSize: 12, bold: true },
                { text: 'сотиш-харид қилиш шартномаси\n', fontSize: 12, bold: true },
                { text: `№ ${leadId || '___________________________'}\n\n`, fontSize: 10 },
                { text: `Тошкент ш.   "${day}" ${month} ${year} й.\n\n`, fontSize: 10 },
                {
                  text: '«PROBOX GROUP CO» МЧЖ кейинги ўринларда "Сотувчи" деб аталувчи, Устав асосида ҳаракат қилувчи директор Нигматов О.Х. номидан, бир томондан, ва\n\n',
                  fontSize: 9,
                },
                { text: `(ФИШ) ${clientName || '_______________________'}\n`, fontSize: 9, bold: true },
                { text: `паспорт/id: ${passportId || '______________'}, ЖШШИР) ${jshshir || '______________'}\n`, fontSize: 9 },
                { text: 'паспорт берилган сана)да берилган,\n', fontSize: 9 },
                { text: `(яшаш манзили) ${clientAddress || '_______________________'}\n`, fontSize: 9 },
                {
                  text: 'манзилда истиқомад қилувчи, Ўзбекистон Республикаси фуқароси, кейинги ўринларда "Харидор" деб аталувчи бошқа томондан, ушбу шартномани қуйидагилар ҳақида туздилар:\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: 'Договор купли-продажи\n', fontSize: 12, bold: true },
                { text: 'на основе рассрочки\n', fontSize: 12, bold: true },
                { text: `№ ${leadId || '___________________________'}\n\n`, fontSize: 10 },
                { text: `г. Ташкент   "${day}" ${monthRu} ${year} г.\n\n`, fontSize: 10 },
                {
                  text: 'ООО «PROBOX GROUP CO», далее именуемое «Продавец», в лице директора Нигматова О.Х., действующего на основании Устава, с одной стороны, и гражданин Республики Узбекистан:\n\n',
                  fontSize: 9,
                },
                { text: `(ФИО) ${clientName || '_______________________'}\n`, fontSize: 9, bold: true },
                { text: `серия и номер паспорта/id: ${passportId || '______________'}, ЖШШИР) ${jshshir || '______________'}\n`, fontSize: 9 },
                { text: 'выдан ____________(дата выдачи),\n', fontSize: 9 },
                { text: `проживающий по адресу: ${clientAddress || '_______________________'}\n`, fontSize: 9 },
                {
                  text: 'далее именуемый "Покупатель", с другой стороны, заключили настоящий Договор о нижеследующем:\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 1. SHARTNOMA PREDMETI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '1. ШАРТНОМА ПРЕДМЕТИ\n', fontSize: 10, bold: true },
                {
                  text: '1.1.Сотувчи Товар (кейинги ўринларда "Товар" деб юритилади): ва унинг тўпламига кирувчи аксессуарларни ва хужжатлари Харидорга фойдаланиши учун топшириш, Харидор эса Товар қийматини ушбу Шартномада кўрсатилган шартларда ва миқдорда тўлаш мажбуриятини олади.\n\n',
                  fontSize: 9,
                },
                { text: '1.2.Сотилган товар хақида маълумот:\n', fontSize: 9 },
                { text: `${itemName1} IMEI 1 код: ${imei1}\n`, fontSize: 9 },
                {
                  text: DocumentLines.length > 1 ? `IMEI 2 код: ${imei2}\n\n` : 'IMEI 2 код: _____________________________\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '1. ПРЕДМЕТ ДОГОВОРА\n', fontSize: 10, bold: true },
                {
                  text: '1.1. Продавец обязуется передать Покупателю Товар (далее по тексту "Товар") и входящие в его состав аксессуары и документы, а Покупатель, в свою очередь, обязуется оплатить стоимость Товара на условиях настоящего Договора.\n\n',
                  fontSize: 9,
                },
                { text: '1.2. Информация о продаваемом Товаре:\n', fontSize: 9 },
                { text: `${itemName1} IMEI 1 код: ${imei1}\n`, fontSize: 9 },
                {
                  text: DocumentLines.length > 1 ? `IMEI 2 код: ${imei2}\n\n` : 'IMEI 2 код: _____________________________\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 2. SHARTNOMA QIYMATI VA TO'LOV TARTIBI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '2. ШАРТНОМА ҚИЙМАТИ ВА ТЎЛОВ ТАРТИБИ\n', fontSize: 10, bold: true },
                {
                  text: `2.1.Шартнома имзоланган кунида Товарнинг умумий қиймати ${totalPriceFormatted} сўмни ташкил қилади.\n\n`,
                  fontSize: 9,
                },
                {
                  text: '2.2.Харидор Товар учун олдиндан _________ ____________________________ сўм тўловни амалга оширади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.3.Харидор Товарнинг қолган____________ ___________________________сўм қийматини _____ ой давомида Тўлов жадвали (1-Илова) буйича тўлов қилишга мажбур.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.4.Тўлов муддати ҳар ойнинг _______-кунида амалга оширилади. Товар қиймати АҚШ долларида белгиланган бўлиб, Ўзбекистон Республикаси Марказий банки томонидан белгиланган расмий валюталар курси асосида сўмда тўланади. Тўлов амалга оширилаётган кунги расмий курс ҳисобга олинади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.5. Юқорида кўрсатилган устама миқдори Товарнинг қолган нархига (2.3-банд) нисбатан ҳисобланади. Тўловлар тенг миқдордаги (аннуитет) тўловлар усули бўйича ҳисобланади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.6. Харидор муддатидан олдин тўлиқ ёки қисман тўловни амалга ошириш ҳуқуқига эга. Бунда, муддатидан олдин тўланган сумма учун олдиндан шартнома тузилган умумий қиймат (2.1-банд) қайта ҳисобланмайди (ўзгармайди).\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.7.Шартнома бўйича тўловлар ва товарларни сотиб олишда Харидорга нисбатан ҳеч қандай қўшимча комиссия, йиғим ёки жарималар (пеня) қўлланилмайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.8. Харидор ушбу Шартнома бўйича тўловларни тасдиқловчи чекларни сақлашга мажбурдир. Акс ҳолда, мунозарали вазиятларда тўлов чекни тақдим этилмаса, Харидор томонидан амалга оширилган тўлов ҳисобга олинмаслиги мумкин.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '2.СТОИМОСТЬ ДОГОВОРА И ПОРЯДОК ОПЛАТЫ\n', fontSize: 10, bold: true },
                {
                  text: `2.1. На день подписания Договора общая стоимость Товара: составляет ${totalPriceFormatted} сум.\n\n`,
                  fontSize: 9,
                },
                {
                  text: '2.2. Предоплата за Товар: _____________ _________________________________сум.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.3.Оставшуюся стоимость Товара: __________________________________сум Покупатель обязуется выплатить в течение ______месяцев согласно Графику платежей (Приложение 1).\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.4.Срок ежемесячной оплаты Товара устанавливается на _____-е число каждого месяца. "Стоимость товара установлена в долларах США и подлежит оплате в сумах на основе официального курса валют, установленного Центральным банком Республики Узбекистан. При этом учитывается официальный курс валют на день осуществления платежа."\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.5.Указанная выше сумма наценки начисляется по отношению к остаточной стоимости Товара (пункт 2.3). Платежи рассчитываются по методу равных (аннуитетных) платежей.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.6. Покупатель вправе произвести полную или частичную досрочную оплату. При этом, общая стоимость договора (п.2.1), согласованная заранее, не пересчитывается (остается неизменной).\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.7. При оплате и покупке Товара по Договору, в отношении Покупателя не применяются никакие дополнительные комиссии, сборы или штрафы (пени).\n\n',
                  fontSize: 9,
                },
                {
                  text: '2.8. Покупатель обязуется хранить чеки. подтверждающие оплаты по настоящему Договору. В противном случае, в спорных ситуациях, при непредоставлении чека об оплате, произведенная Покупателем оплата может быть не засчитана.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 3. TOVAR TOPSHIRISH
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '3. ТОВАРНИ ТОПШИРИШ ТАРТИБИ\n', fontSize: 10, bold: true },
                {
                  text: '3.1.Товарни топшириш қуйидаги манзиллар бўйича амалга оширилади:\n\n',
                  fontSize: 9,
                },
                {
                  text: '1) Тошкент шаҳри, Олмазор тумани, Нурафшон айланма кўчаси, 1 уй, 12 хонадон.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2) Тошкент шаҳри, Шайхонтохур тумани, Коратош кўчаси, 55-уй.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3)Тошкент шаҳри Мирзо Улуғбек тумани Паркент кўчаси 195-уй 199-хонадон.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.2.Ушбу Шартноманинг 2.2.-бандида кўрсатилган олдиндан тўлов амалга оширишдан олдин Харидор Товарнинг тўлиқлиги ва яроқлигини текширишга мажбур.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.3.Олдиндан тўловни амалга ошириши орқали Харидор ўзи харид қилган Товарни танлагани текшириб кўрганлиги ва қабул қилишга тайёрлигини тасдиқлайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.4.Сотувчи ушбу Шартнома бўйича Товарни харидорга олдиндан тўловини амалга оширган пайтдан бошлаб 1 (бир) календар кун давомида топширади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.5. Товар тегишли хужжатлар билан IMEI-1 ни рўйхатдан ўтказган холда топширади. IMEI-2 рўйхатдан ўтказиш харидорнинг хоҳишига кўра амалга оширилади, агар талаб этилса Давлат стандартлари асосида, рўйхатдан ўтказиш учун қўшимча тўлов қилиш талаб қилинади Товарнинг қутиси ушбу Шартноманинг 2.1.-бандда кўрсатилган тўлиқ қиймати тўланганидан кейин Харидорга топширади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.6.Олдиндан тўлов амалга оширгандан сўнг, Харидор томонидан Товарни қабул қилишдан турли сабабларга кўра рад этилган тақдирда, тўланган олдиндан тўлов қайтарилмайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.7.Товарга эгалик хуқуқи ушбу Шартноманинг 2.1-бандида кўрсатилган Товарнинг тўлиқ қиймати тўланган пайтдан бошлаб Харидорга ўтади.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '3. ПОРЯДОК ПЕРЕДАЧИ ТОВАРА\n', fontSize: 10, bold: true },
                {
                  text: '3.1. Передача Товара осуществляется по следующему адресу:\n\n',
                  fontSize: 9,
                },
                {
                  text: '1) г. Ташкент, Алмазарский район, ул. Нурафшон, 1-дом, 12-квартира.\n\n',
                  fontSize: 9,
                },
                {
                  text: '2) г. Ташкент, Шайхантахурский район, ул. Коратош, 55-дом.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3)г.Ташкент, Мирзо Улугбекский район, ул. Паркент, 195-дом, 199 кв\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.2. Покупатель перед оплатой предоплаты, предусмотренной п.2.2 настоящего Договора, обязуется проверить Товар на предмет комплектности и пригодности.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.3. Осуществляя предоплату, Покупатель подтверждает, что проверил выбранный Товар и готов его принять.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.4. Продавец передает Покупателю Товар в течение 1 (одного) календарного дня с момента осуществления предоплаты.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.5.Товар передаётся с соответствующими документами после регистрации IMEI-1. Регистрация IMEI-2 осуществляется по желанию покупателя. Если требуется, регистрация производится в соответствии с государственными стандартами, при этом взимается дополнительная плата. Коробка от товара передаётся покупателю после полной оплаты его стоимости, указанной в пункте 2.1 настоящего договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.6. В случае отказа Покупателем от принятия Товара после осуществления предоплаты уплаченная сумма предоплаты Покупателю не возвращается.\n\n',
                  fontSize: 9,
                },
                {
                  text: '3.7. Право собственности на Товар переходит к Покупателю с момента оплаты полной стоимости Товара, указанной в п.2.1 настоящего Договора.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 4. TOMONLARNING HUQUQ VA MAJBURIYATLARI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '4. ТОМОНЛАРНИНГ ҲУҚУҚ ВА МАЖБУРИЯТЛАРИ\n', fontSize: 10, bold: true },
                { text: '4.1.Сотувчининг мажбуриятлари:\n', fontSize: 9, bold: true },
                {
                  text: '4.1.1. Товарни сотиш вақтида Ўзбекистон Республикасининг қонун ҳужжатлари томонидан белгиланган талабларга жавоб берадиган маҳсулот ҳақидаги зарур ва ишончли маълумотларни ҳаридорга тақдим этиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.1.2. Ушбу Шартноманинг 3.4-бандида кўрсатилган муддатда Товарни топшириш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.1.3. Тегишли сифатдаги Товарни топшириш.\n\n',
                  fontSize: 9,
                },
                { text: '4.2.Сотувчининг хуқуқлари:\n', fontSize: 9, bold: true },
                {
                  text: '4.2.1. Ушбу Шартноманинг шартларига мувофиқ Товар учун ўз вақтида тўловни талаб қилиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.2.2. Ушбу Шартноманинг тўлов шартлари бузилган тақдирда, Харидордан Товарни қайтариб олиш. Шу билан бирга, Харидор томонидан олдин тўланган пул миқдори қайтарилмайди ва Сотувчининг йўқотишлари қоплаш учун кетади.\n\n',
                  fontSize: 9,
                },
                { text: '4.3.Харидорнинг мажбуриятлари:\n', fontSize: 9, bold: true },
                {
                  text: '4.3.1. Ушбу Шартнома бўйича тўловларни ўз вақтида амалга ошириш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.2. Макур шартноманинг 2.2-банида кўрсатилган олдиндан тўлов амалга оширишдан сўнг Товарни қабул қилиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.3. Товарни ушбу Шартноманинг 2.1.-бандида кўрсатилган Товарнинг умумий қиймати тўламасдан учинчи шахсга ўтказмаслик.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.4. Мижоз томонидан шартномада белгиланган тўловларнинг тўлиқ амалга оширилиши натижасида қарздорлик бартараф этилгач, мижоз маҳсулотнинг оригинал қутисини 3 (уч) календар ой ичида олиб кетиши шарт. Харидордан бу жараёнда шахсни тасдиқловчи хужжат талаб этилади. Агар мижоз ушбу муддат ичида қутини олиб кетмаса, 3 ойдан ортиқ сақланган қутилар утилизация қилинади ва мижоз бу борада ҳеч қандай даъво ёки эътироз билдириш ҳуқуқига эга эмас.\n\n',
                  fontSize: 9,
                },
                { text: '4.4.Харидорнинг хуқуқлари:\n', fontSize: 9, bold: true },
                {
                  text: '4.4.1. Товарни сотиб олиш вақтида Ўзбекистон Республикасининг қонун ҳужжатлари томонидан белгиланган талабларга жавоб берадиган маҳсулот ҳақидаги зарур ва ишончли маълумотларни талаб қилиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.4.2. Товарни қабул қилишдан олдин унинг функцияларини текширишни ёки агар бу Товарнинг хусусиятига кўра истисно қилинмаса Товардан фойдаланишни кўрсатиб беришни талаб қилиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.4.3. Ушбу Шартноманинг 5-бобида белгиланган шартларига мувофиқ қафолат ҳолати юзага келган тақдирда, носозликолрани бартараф этишни талаб қилиш.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '4. ПРАВА И ОБЯЗАННОСТИ СТОРОН\n', fontSize: 10, bold: true },
                { text: '4.1. Обязанности Продавца:\n', fontSize: 9, bold: true },
                {
                  text: '4.1.1. При реализации товара предоставить Покупателю необходимую и достоверную информацию о Товаре, отвечающую требованиям норм законодательства Республики Узбекистан.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.1.2. Передать Товар в сроки, установленные п.3.4 настоящего Договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.1.3. Передать Товар надлежащего качества.\n\n',
                  fontSize: 9,
                },
                { text: '4.2. Права Продавца:\n', fontSize: 9, bold: true },
                {
                  text: '4.2.1. Требовать своевременной оплаты Товара на условиях настоящего Договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.2.2. В случае нарушения условий оплаты, предусмотренных настоящим Договором, изъять Товар у Покупателя. При этом, денежные средства, ранее оплаченные Покупателем, не возвращаются, а идут в счет покрытия убытков Продавца.\n\n',
                  fontSize: 9,
                },
                { text: '4.3. Обязанности Покупателя:\n', fontSize: 9, bold: true },
                {
                  text: '4.3.1. Своевременно осуществлять платежи по настоящему Договору.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.2. Принять Товар после проведения предоплаты, указанной в п.2.2. настоящего Договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.3. Не передавать Товар третьим лицам до момента полной оплаты стоимости Товара, указанной в п.2.1. настоящего Договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.3.4. После полного исполнения клиентом обязательств по оплате, указанных в контракте, и погашения задолженности, клиент обязан забрать оригинальную упаковку товара в течение 3 (трех) календарных месяцев. От покупателя в этом процессе требуется удостоверяющий личность документ. В случае, если клиент не заберет упаковку в указанный срок, упаковки, хранящиеся более 3 месяцев, подлежат утилизации, и клиент не имеет права предъявлять какие-либо претензии или возражения по данному поводу.\n\n',
                  fontSize: 9,
                },
                { text: '4.4. Права Покупателя:\n', fontSize: 9, bold: true },
                {
                  text: '4.4.1. При покупке Товара требовать необходимую и достоверную информацию о Товаре, отвечающую требованиям норм законодательства Республики Узбекистан.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.4.2.Требовать проверки функциональности Продукта перед его приемкой или демонстрации использования Продукта, если это не исключается из-за характера Продукта.\n\n',
                  fontSize: 9,
                },
                {
                  text: '4.4.3. В случае возникновения гарантийного случая в соответствии с условиями раздела 5 настоящего Договора, требовать исправления неполадок.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 5. KAFOLAT
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '5. КАФОЛАТ\n', fontSize: 10, bold: true },
                { text: '5.1.Товарнинг кафолат муддати:\n', fontSize: 9 },
                { text: '- янги Товар учун – 1 (бир) ой;\n', fontSize: 9 },
                { text: '- ишлатилган Товар учун – 1 (бир) ҳафта ташил этади.\n\n', fontSize: 9 },
                {
                  text: '5.2.Ушбу Шартноманинг 5.1 -бандида кўрсатилган кафолат муддати Товар Харидорга топширилган пайтдан бошлаб ҳисобланади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.3.Томонлар ушбу Шартнома бўйича сотилган товарнинг кафолати деганда Тошкент шаҳридаги расмий хизмат кўрсатиш марказида техник таъмирлаш тушунилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.4.Агар харидорнинг айби билан эмас, балки ишлаб чиқарувчининг айби билан кафолат ҳолати юзага келса, Сотувчи зарур маслаҳатларни беради ва товарни хизмат кўрсатиш ва носозликларни бартараф этиш учун хизмат кўрсатиш марказига топширишни ташкиллаштиради..\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.5.Ушбу Шартномада қафолат ҳолати деганда қуйидагиларни тушунилади:\n',
                  fontSize: 9,
                },
                {
                  text: '- ишлаб чиқарувчи айби туфайли юзага келган Товарнинг носозликлар;\n',
                  fontSize: 9,
                },
                {
                  text: '- ишлаб чиқарувчи айби туфайли Товардан мақсадли фойдаланишнинг мумкин эмаслиги;\n',
                  fontSize: 9,
                },
                {
                  text: '- ишлаб чиқарувчи айби туфайли Товарнинг ишламаслиги.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.6.Харидор Товарни бошқа мақсадларда ишлатилган ёки уни ишлаб чиқарувчининг кўрсатмаларидан фарқли равишда ишлатилган тақдирда, Сотувчи Харидор олдида ҳеч қандай кафолат мажбуриятларини ўз зиммасига олмайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.7.Юқорида кўрсатилган ҳолатларга қўшимча равишда, Сотувчи Харидорга носозлик сабабларидан қатъи назар, янги Товарни 10 000 000 (ўн миллион) сўмгача бўлган бир марталик техник таъмирлаш хизматини тақдим этади. Техник таъмирлаш хизмати   3 (уч) иш кунидан 14 (ўн тўрт) иш кунигача кўрсатилади.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '5. ГАРАНТИЯ\n', fontSize: 10, bold: true },
                { text: '5.1. Гарантийный срок на Товар:\n', fontSize: 9 },
                { text: '- на новый Товар – 1 (один) месяц;\n', fontSize: 9 },
                { text: '- на Товар, бывший в употреблении 1 (одна) неделя.\n\n', fontSize: 9 },
                {
                  text: '5.2. Гарантийный рок, указанный в п.5.1. настоящего Договора считается с момента передачи Товара Покупателю.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.3. Гарантия товара, реализуемого сторонами по настоящему Договору, подразумевает технический ремонт в официальном сервисном центре в г. Ташкент.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.4. В случае возникновения гарантийной ситуации по вине производителя, а не Покупателя, Продавец предоставит необходимую консультацию и организует передачу Товара в сервисный центр для обслуживания и устранения неполадок.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.5. По смыслу настоящего Договора гарантийный случай подразумевает следующее:\n',
                  fontSize: 9,
                },
                {
                  text: '- неполадки Товара, возникшие по вине производителя;\n',
                  fontSize: 9,
                },
                {
                  text: '- невозможность использования Товара по назначению по вине производителя;\n',
                  fontSize: 9,
                },
                {
                  text: '- выход из строя Товара по вине производителя.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.6. В случае, если Покупатель использует Товар не по назначению или использует его вопреки указаниям производителя, Продавец не несет перед Покупателем никаких гарантийных обязательств.\n\n',
                  fontSize: 9,
                },
                {
                  text: '5.7. Помимо случаев, указанных выше, Продавец предоставляет Покупателю разовое техническое ремонтное обслуживание новые Товара на сумму до 10 000 000 (десяти миллионов) сум вне зависимости от причины неполадки. Услуга технического ремонта предоставляется от 3 (трех) рабочих дней до 14 (четырнадцати) рабочих дней.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 6. TOMONLARNING JAVOBGARLIGI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '6. ТОМОНЛАРНИНГ ЖАВОБГАРЛИГИ\n', fontSize: 10, bold: true },
                {
                  text: '6.1.Ушбу Шартнома бўйича мажбуриятларни бажармаганлик ёки лозим даражада бажармаганлик учун томонлар Ўзбекистон Республикасининг амалдаги қонун ҳужжатларига мувофиқ жавобгар бўладилар.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.Ушбу Шартнома буйича Харидор томонидан тўловларни ўз вақтида амалга оширилмаган тақдирида Сотувчи қуйидаги чораларни кўриш мумкин:\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.1. Сотувчи Харидорга тўлов муддати яқинлашганини ёки кечикканини қуйидаги усуллар билан эслатиш ҳуқуқига эга:\n',
                  fontSize: 9,
                },
                {
                  text: 'Тўлов санасидан 3 (уч) кун олдин SMS-хабарнома юбориши (ихтиёрий). Тўлов санаси куни ва ундан кейинги 1 (бир) кун ичида телефон орқали қўнғироқ қилиши.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.2. Тўлов санасидан кейинги 5 (беш) кун ичида телефон орқали алоқа ўрнатиш имкони бўлмаса, Сотувчи ходимлари қарзни музокара йўли билан ҳал қилиш учун (имкон бўлган ҳудудларда) Харидорнинг яшаш жойига ташриф буюриши мумкин.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.3. Ушбу Шартнома бўйича муддати ўтган тўловларни Харидорнинг шартномада кўрсатилган банк карталаридан акцептсиз равишда ҳисобдан чиқариш ҳуқуқи Сотувчида мавжуд. Харидор Шартномани имзолаш орқали бунга розилик билдиради.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3. Агар Харидор тўловни 3 (уч) календарь куни ичида амалга оширмаса, унга "iCloud" тизими орқали огоҳлантирувчи хабарнома юборилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.1. Агар Харидор Товар учун тўловни белгиланган кундан 4 (тўрт) календарь кун кечиктирса, мобил қурилма (Товар) қонунчиликда рухсат этилган тартибда "iCloud" ва/ёки "IMEI" тизими орқали блоклаш ҳақида огоҳлантирилади ва Сотувчи IMEI тизими орқали блоклаш жараёнини бошлайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.2.Муддати ўтган тўлов амалга оширилгандан сўнг 48 (қирқ саккиз) соат ичида мобил қурилма (Товар) "IMEI" тизими орқали блокдан очилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.3. Харидор "iCloud" орқали блоклаш натижасида маълумотларнинг автоматик ўчирилиши мумкинлигидан огоҳлантирилади ва тўлов мажбуриятини бажармаганлиги сабабли, маълумотларнинг йўқотилиши учун жавобгарликни ўз зиммасига олади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.4. Сотувчи "iCloud" ва "IMEI" тизимларидан фақат шартнома шартларини бузган Харидорларни аниқлаш ва блоклаш мақсадида фойдаланишини кафолатлайди. Сотувчи Товар нархини тўлиқ тўлагандан сўнг, ушбу тизимлардан фойдаланмасликка ва Харидорнинг шахсий маълумотларига кириш ҳуқуқига эга эмаслигини кафолатлайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.4.1. Агар Харидор икки ёки ундан ортиқ товар (мобил телефон ва гаджетлар) сотиб олса ва улардан бири бўйича тўловни кечиктирса ёки амалга оширмаса, барча сотиб олинган товарлар (шу жумладан, тўлови тўлиқ амалга оширилган мобил телефон ҳам) компания томонидан блокланиши мумкин.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.4.2. Барча маҳсулотлар блокдан чиқарилиши учун барча маҳсулотлар бўйича қарздорликнинг тўлиқ тўланиши зарур.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.5.1. Сотувчи, Харидор томонидан Товар учун тўловлар 7 (етти) календарь кунидан ортиқ муддатга кечиктирилган тақдирда, 6.5-банддаги Вақтинчалик Олиб Қўйиш механизмини қўлламаган ҳолда, Шартномани бир томонлама бекор қилиш ҳуқуқига эга. Бунда 4.2.2, 6.7.3 ҳамда 7-бўлим қоидаларига мувофиқ қайта ҳисоб-китоб қилиш жараёни бошланади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.5.2. Агар блоклаш чоралари (6.2-банд) қўлланилгандан сўнг 3 (уч) календарь кун ичида ҳам тўлов амалга оширилмаса ёки низо ҳал этилмаса (яъни, тўлов санасидан 7 кун ўтса), Сотувчи шартномани бир томонлама бекор қилиш тўғрисида Харидорга ёзма хабар юборишга ҳақли ва низо суд орқали ҳал қилинади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.1. Агар Харидор томонидан Товар учун ойлик тўловлар 7 (етти) календарь кунидан ортиқ муддатга кечиктирилса ва блоклаш механизмлари ишга солган бўлса-да, қарздорлик бартараф этилмаса:\n',
                  fontSize: 9,
                },
                {
                  text: 'Сотувчи, Харидорнинг ёзма аризаси ёки оғзаки розилиги асосида, Шартномани тўлиқ бекор қилиш ўрнига, Товарни фақат вақтинчалик сақлаш учун олиб қўйиш ҳуқуқига эга.\n',
                  fontSize: 9,
                },
                {
                  text: 'Ушбу вақтинчалик олиб қўйиш Харидорнинг қолган қарздорликни тўлаш мажбурияти сақланиб қолишини тасдиқлайди.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.2. Товар вақтинчалик олиб қўйилган вақтда, Харидор қарздорликни бартараф этиш мажбуриятини сақлаб қолади. Барча қарздорлик тўлиқ ёпилган кундан бошлаб, Сотувчи Товарни 3 (уч) иш куни ичида Харидорга қайтаришга мажбур.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.3. Агар Товар вақтинчалик олиб қўйилган кундан бошлаб 30 (ўттиз) календарь куни ичида Харидор қарздорликни тўлиқ бартараф этмаса, ушбу вақтинчалик олиб қўйиш автоматик равишда Шартномани тўлиқ бекор қилиш сифатида тан олинади ва қайта ҳисоб-китоб қилиш жараёни бошланади. Бу Шартномани бир томонлама бекор қилиш учун энг узоқ муддат (жами 37 кун) ҳисобланади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.1. Агар Харидор Товарни учинчи шахсларга топширса ёки бирон сабабга кўра ўз эгалигидан йўқотса, Товарни тўлаш мажбурияти Харидорда қолади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.2. Харидор вафот этган тақдирда, ушбу Шартнома бўйича унинг мажбуриятлари қонун ёки васиятнома бўйича меросхўрларига ўтади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.3. Юқоридаги чоралар Сотувчининг ихтиёрига кўра амалга оширилади ва улардан бирини қўллаш қонун ҳужжатларида назарда тутилган бошқа чораларни қўллашни чекламайди.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '6. ОТВЕТСТВЕННОСТЬ СТОРОН\n', fontSize: 10, bold: true },
                {
                  text: '6.1. За неисполнение или ненадлежащее исполнение обязательств по настоящему Договору стороны несут ответственность в соответствии с действующим законодательством Республики Узбекистан.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2. В случае несвоевременного осуществления платежей Покупателем по настоящему Договору Продавец вправе принять следующие меры:\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.1. Продавец имеет право напоминать Покупателю о приближении срока платежа или о его просрочке следующими способами:\n',
                  fontSize: 9,
                },
                {
                  text: '– за 3 (три) календарных дня до даты платежа направить SMS-уведомление;\n',
                  fontSize: 9,
                },
                {
                  text: '– в день платежа и в течение 1 (одного) дня после него позвонить Покупателю по телефону.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.2. Если в течение 5 (пяти) календарных дней после даты платежа не удаётся установить телефонный контакт с Покупателем, сотрудники Продавца могут (в регионах, где это возможно) посетить место проживания Покупателя для урегулирования задолженности путем переговоров.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.2.3. Продавец имеет право списывать просроченные платежи по настоящему Договору с банковских карт Покупателя, указанных в договоре, без акцепта. Подписывая Договор, Покупатель выражает согласие на это.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3. Если Покупатель не произведет оплату в течение 3 (трёх) календарных дней, ему направляется уведомление через систему «iCloud».\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.1. Если Покупатель задерживает оплату за Товар более чем на 4 (четыре) календарных дня с установленной даты, он уведомляется о возможности блокировки мобильного устройства (Товара) через системы «iCloud» и/или «IMEI» в порядке, разрешённом законодательством, после чего Продавец инициирует процесс блокировки через систему IMEI.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.2. После осуществления просроченного платежа мобильное устройство (Товар) разблокируется через систему IMEI в течение 48 (сорока восьми) часов.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.3. Покупатель уведомляется, что в результате блокировки через «iCloud» возможно автоматическое удаление данных, и принимает на себя ответственность за утрату данных, произошедшую из-за неисполнения обязательства по оплате.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.3.4. Продавец гарантирует использование систем «iCloud» и «IMEI» исключительно для выявления и блокировки Покупателей, нарушивших условия договора. Продавец обязуется не использовать эти системы и не иметь доступа к личным данным Покупателя после полной оплаты стоимости Товара.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.4.1. Если Покупатель приобрел два и более товара (мобильные телефоны и гаджеты) и допустил просрочку или неоплату хотя бы по одному из них, Продавец имеет право заблокировать все приобретённые товары, включая полностью оплаченные устройства.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.4.2. Разблокировка всех товаров производится только после полного погашения задолженности по всем приобретённым товарам.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.5. Продавец имеет право в одностороннем порядке расторгнуть Договор без применения механизма временного изъятия, указанного в пункте 6.5, если Покупатель задерживает оплату за Товар более чем на 7 (семь) календарных дней. В этом случае начинается процедура взаиморасчётов в соответствии с пунктами 4.2.2, 6.7.3 и разделом 7 настоящего Договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.5.2. Если после применения мер блокировки (пункт 6.2) в течение 3 (трёх) календарных дней оплата не поступит или спор не будет урегулирован (т.е. по истечении 7 дней с даты платежа), Продавец вправе направить Покупателю письменное уведомление о расторжении договора в одностороннем порядке и передать спор на рассмотрение суда.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.1. Если ежемесячные платежи по Товару задерживаются более чем на 7 (семь) календарных дней и, несмотря на применение мер блокировки, задолженность не погашена:\n',
                  fontSize: 9,
                },
                {
                  text: 'Продавец имеет право, на основании письменного заявления или устного согласия Покупателя, вместо полного расторжения договора временно изъять Товар для хранения.\n',
                  fontSize: 9,
                },
                {
                  text: 'Такое временное изъятие подтверждает, что обязанность Покупателя по погашению задолженности сохраняется.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.2. Во время временного изъятия Товара Покупатель сохраняет обязанность по погашению задолженности. После полного погашения долга Продавец обязан вернуть Товар Покупателю в течение 3 (трёх) рабочих дней.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.6.3. Если в течение 30 (тридцати) календарных дней с момента временного изъятия Товара Покупатель не погасит задолженность полностью, такое временное изъятие автоматически считается полным расторжением договора, и начинается процедура взаиморасчётов. Это считается максимальным сроком одностороннего расторжения договора (всего 37 дней).\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.1. Если Покупатель передаст Товар третьим лицам или по какой-либо причине утратит владение им, обязательство по оплате Товара остаётся за Покупателем.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.2. В случае смерти Покупателя его обязательства по настоящему Договору переходят к наследникам в соответствии с законом или завещанием.\n\n',
                  fontSize: 9,
                },
                {
                  text: '6.7.3. Перечисленные выше меры применяются по усмотрению Продавца и не ограничивают право Продавца применять иные меры, предусмотренные законодательством.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 7. TOVARNI QAYTARISH VA MOLIYAVIY HISOB-KITOBB
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '7. Товарни қайтариш ва Молиявий хисоб-китоб тамойили\n', fontSize: 10, bold: true },
                {
                  text: '7.1. Товарни қайтариш ва шу асосда Шартнома бўйича ҳисоб-китоб қилиш қуйидаги ҳолатларда амалга оширилади:\n',
                  fontSize: 9,
                },
                {
                  text: 'а) Харидор молиявий қийинчиликлар сабабли Шартнома муддати тугашидан олдин Товарни қайтариш ва Шартномани бекор қилиш ташаббусини Сотувчига ёзма равишда билдирганда.\n',
                  fontSize: 9,
                },
                {
                  text: 'б) Сотувчи Харидор тўлов интизомини қатъий бузганлиги сабабли Товарни олиб қўйганда ва сотишга ҳақли бўлганда.\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.2. 7.1-банднинг (а) кичик банди асосида қайтарилган тақдирда, Харидор Товарни ўз ҳисобидан 5 (беш) иш куни ичида Сотувчи кўрсатган манзилга етказиб бериш мажбуриятини олади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.3.Сотувчи қайтариб олинган Товарни қайтариш кунидаги бозор қийматида (Товарнинг ҳолати, эскириш даражаси ва нуқсонларини ҳисобга олган ҳолда, тарафларнинг ўзаро келишуви ёки мустақил баҳоловчи асосида) ҳисоб-китоб қилишга мажбур.\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.4. Ҳисоб-китоб қуйидаги тартибда амалга оширилади:\n',
                  fontSize: 9,
                },
                {
                  text: 'Товарнинг қайта сотиб олиш қийматидан аввало Харидорнинг Сотувчи олдидаги умумий қарзи қопланади. Агар қайта сотиб олиш қиймати қарздан юқори бўлса, ортган маблағ 10 (ўн) иш куни ичида Харидорга қайтарилади. Агар қайта сотиб олиш қиймати қарзни тўлиқ қопламаса, етишмаётган қисми (Сотувчининг зарари) Харидор томонидан 3 (уч) иш куни ичида қоплаб берилади.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '7. ПРИНЦИП ВОЗВРАТА ТОВАРА И ФИНАНСОВОГО РАСЧЕТА\n', fontSize: 10, bold: true },
                {
                  text: '7.1. Возврат Товара и, на его основе, расчет по Договору осуществляются в следующих случаях:\n',
                  fontSize: 9,
                },
                {
                  text: 'а) Когда Покупатель по причине финансовых затруднений инициирует письменное уведомление Продавца о желании вернуть Товар и расторгнуть Договор до истечения его срока.\n',
                  fontSize: 9,
                },
                {
                  text: 'б) Когда Продавец изымает Товар и имеет право на его продажу по причине строгого нарушения Покупателем платежной дисциплины.\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.2. При возврате на основании подпункта (а) пункта 7.1, Покупатель обязан доставить Товар за свой счет по адресу, указанному Продавцом, в течение 5 (пяти) рабочих дней.\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.3. Продавец обязан произвести расчет возвращенного Товара по его рыночной стоимости на дату возврата (с учетом состояния, степени износа и дефектов Товара, на основании взаимного соглашения сторон или независимого оценщика).\n\n',
                  fontSize: 9,
                },
                {
                  text: '7.4. Расчет осуществляется в следующем порядке:\n',
                  fontSize: 9,
                },
                {
                  text: 'Из стоимости обратного выкупа Товара в первую очередь погашается общая задолженность Покупателя перед Продавцом. Если стоимость обратного выкупа превышает задолженность, разница возвращается Покупателю в течение 10 (десяти) рабочих дней.\n',
                  fontSize: 9,
                },
                {
                  text: 'Если стоимость обратного выкупа не покрывает задолженность полностью, недостающая часть (убыток Продавца) покрывается Покупателем в течение 3 (трех) рабочих дней.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 8. MAXFIYLIK VA SHAXSIY MA'LUMOTLARNI HIMOYA QILISH
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '8. МАХФИЙЛИК ВА ШАХСИЙ МАЪЛУМОТЛАРНИ ҲИМОЯ ҚИЛИШ\n', fontSize: 10, bold: true },
                {
                  text: '8.1. Тарафлар ушбу Шартнома шартларини, жумладан Товар нархи, молиявий ҳисоб-китоблар ва Тўлов жадвали маълумотларини махфий деб ҳисоблайдилар ва қонунчиликда белгиланган ҳолатлардан ташқари, учинчи шахсларга ошкор қилмаслик мажбуриятини оладилар.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.2. Харидор ушбу Шартномани имзолаш орқали, Сотувчига ўз шахсий маълумотларини (Ф.И.Ш., паспорт/ID маълумотлари, ЖШШИР, яшаш манзили, телефон рақами ва бошқалар) Ўзбекистон Республикасининг "Шахсий маълумотлар тўғрисида"ги Қонуни талабларига мувофиқ қайта ишлаш, сақлаш ва фойдаланишга ўз розилигини беради.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.3.Сотувчи Харидорнинг шахсий маълумотларидан фақат қуйидаги мақсадларда фойдаланиш ҳуқуқига эга:\n',
                  fontSize: 9,
                },
                {
                  text: 'Шартнома бўйича мажбуриятларни бажариш (Товарни етказиб бериш, тўловларни ҳисобга олиш, кафолат хизмати);\n',
                  fontSize: 9,
                },
                {
                  text: 'Харидорнинг тўлов интизоми ва кредит тарихини баҳолаш ва мониторинг қилиш.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.4. Харидор, шунингдек, Сотувчига ушбу Шартнома бўйича тўлов интизоми, муддати ўтган қарздорлик ёки Шартноманинг бажарилиши ҳақидаги маълумотларни Ўзбекистон Республикасида фаолият юритувчи Кредит ахборотлари бюроларига (шу жумладан, "Кредит ахбороти алмашинуви тўғрисида"ги Қонунга асосан) узатишга ва қайта ишлашга тўлиқ розилик беради.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.5. Сотувчи Шахсий маълумотларнинг рухсатсиз кириш, ўзгартириш ёки йўқ қилинишдан ҳимоя қилинишини таъминлаш учун зарур ташкилий ва техник чораларни кўриш мажбуриятини олади.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '8. КОНФИДЕНЦИАЛЬНОСТЬ И ЗАЩИТА ПЕРСОНАЛЬНЫХ ДАННЫХ\n', fontSize: 10, bold: true },
                {
                  text: '8.1.Стороны считают условия настоящего Договора, включая цену Товара, финансовые расчеты и данные Графика Платежей, конфиденциальными и обязуются не разглашать их третьим лицам, за исключением случаев, установленных законодательством.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.2. Покупатель, подписывая настоящий Договор, дает свое согласие Продавцу на обработку, хранение и использование своих персональных данных (Ф.И.О., паспортные/ID данные, ЖШШИР, адрес проживания, номер телефона и прочее) в соответствии с требованиями Закона Республики Узбекистан "О персональных данных".\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.3. Продавец имеет право использовать персональные данные Покупателя исключительно в следующих целях:\n',
                  fontSize: 9,
                },
                {
                  text: 'Исполнение обязательств по Договору (доставка Товара, учет платежей, гарантийное обслуживание);\n',
                  fontSize: 9,
                },
                {
                  text: 'Оценка и мониторинг платежной дисциплины и кредитной истории Покупателя.\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.4. Покупатель также дает полное согласие Продавцу на передачу и обработку информации о платежной дисциплине, просроченной задолженности или исполнении настоящего Договора Кредитным информационным бюро, осуществляющим деятельность в Республике Узбекистан (в том числе на основании Закона "Об обмене кредитной информацией").\n\n',
                  fontSize: 9,
                },
                {
                  text: '8.5. Продавец обязуется принять необходимые организационные и технические меры для обеспечения защиты Персональных данных от несанкционированного доступа, изменения или уничтожения.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 9. FORS-MAJOR HOLATLARI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '9. ФОРС-МАЖОР ҲОЛАТЛАРИ\n', fontSize: 10, bold: true },
                {
                  text: '9.1.Томонлар ушбу Шартнома бўйича мажбуриятларни қисман ёки тўлиқ бажармаганликлари учун жавобгарликдан озод қилинади, агар ушбу бажарилмаган ҳолатлар шартнома тузилгандан кейин томонлар олдиндан кўра олмайдиган ёки олдини ололмайдиган фавқулодда ҳолатлар (форс-мажор ҳолатлари) натижасида юзага келган бўлса. Форс-мaжoр ҳолатларига қуйидагилар киради: уруш, фавқулодда ҳолат жорий этиш, ёнғин, бошқа авариялар, табиий офат, епидемия, пандемия, иш ташлашлар (локаут, бойкот, блокада), Ўзбекистон Республикасининг норматив-ҳуқуқий ҳужжатлари, махсус комиссиялар ва ваколатли мансабдор шахсларнинг қарорлари, агар уларнинг кучга кириши шартномани бажаришни имконсиз қилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.2. Ушбу Шартноманинг 8.1-бандда кўрсатилган ҳолатлар юзага келганда, ҳар бир томон бошқа томонни 3 (уч) календар кун ичида улар тўғрисида ёзма равишда хабардор қилиши керак. Билдиришномада вазиятларнинг моҳияти тўғрисидаги маълумотлар, шунингдек ушбу ҳолатларнинг мавжудлигини тасдиқловчи ва иложи бўлса, уларнинг шартнома бўйича ўз мажбуриятларини бажариш қобилиятига таъсирини баҳолайдиган расмий ҳужжатлар бўлиши керак.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.3. Агар томон ушбу Шартноманинг 8.2-бандида назарда тутилган билдиришномани юбормаса ёки ўз вақтида юбормаса, агар хабар беришнинг иложи йўқлиги Шартноманинг 8.1-бандида кўрсатилган ҳолатларнинг таъсиридан келиб чиқмаса, у иккинчи томонга етказилган зарарларни қоплаши шарт.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.4. Ушбу Шартноманинг 8.1-бандида назарда тутилган ҳолатлар юзага келган ҳолларда, шартнома бўйича мажбуриятларни бажариш муддати ушбу ҳолатлар ва уларнинг оқибатлари амал қиладиган вақтга, лекин бир ойдан ошмасдан, мутаносиб равишда узайтирилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.5. Агар ушбу Шартноманинг 8.1 - бандида келтирилган ҳолатлар ва уларнинг оқибатлари бир ойдан ортиқ давом этса, ушбу Шартнома томонларнинг ўзаро розилиги билан бекор қилиниши мумкин.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '9. ФОРС-МАЖОР\n', fontSize: 10, bold: true },
                {
                  text: '9.1. Стороны освобождаются от ответственности за частичное или полное неисполнение своих обязательств по настоящему Договору, если это неисполнение является следствием чрезвычайных обстоятельств (форс-мажорных обстоятельств), возникших после заключения Договора, которые стороны не могли предвидеть или предотвратить. К обстоятельствам непреодолимой силы относятся: война, чрезвычайное положение, пожар, иные происшествия, стихийное бедствие, эпидемия, пандемия, забастовки (локаут, бойкот, блокада), нормативные правовые акты Республики Узбекистан, решения специальных комиссий и уполномоченных должностных лиц, если их вступление в силу делает невозможным исполнение договора.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.2. В случае наступления обстоятельств, указанных в пункте 9.1 настоящего Договора, каждая сторона обязана уведомить об этом другую сторону в письменной форме в течение 3 (трех) календарных дней. Уведомление должно содержать сведения о характере обстоятельств, а также официальные документы, подтверждающие наличие этих обстоятельств и, по возможности, оценку их влияния на возможность выполнения своих обязательств по Договору.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.3. Если сторона не направляет уведомление, предусмотренное пунктом 9.2 настоящего Договора, или не направляет его в срок, за исключением случаев, когда невозможность уведомления вызвана обстоятельствами, указанными в пункте 9.1 Договора, она возмещает другой стороне убытки.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.4. При наступлении обстоятельств, предусмотренных пунктом 9.1 настоящего Договора, срок исполнения обязательств по договору продлевается пропорционально времени действия этих обстоятельств и их последствий, но не более чем на один месяц.\n\n',
                  fontSize: 9,
                },
                {
                  text: '9.5. Если обстоятельства, указанные в пункте 9.1 настоящего Договора, и их последствия длятся более одного месяца, настоящий Договор может быть расторгнут по обоюдному согласию сторон.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 10. NIZOLARNI HAL QILISH TARTIBI
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '10. НИЗОЛАРНИ ҲАЛ ҚИЛИШ ТАРТИБИ\n', fontSize: 10, bold: true },
                {
                  text: '10.1.Томонлар ушбу Шартнома юзасидан келиб чиқиши мумкин булган келишмовчилик ва низоларни музокара йўли билан хал қилишга харакат қиладилар.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.2. Харидорнинг ушбу Шартнома билан боғлиқ расмий ёзма талабномаларни кўриб чиқиш муддати 7 (етти) календар кунни ташкил этади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.3.Ушбу Шартнома бўйича Сотувчидан мобил қурилмага юборилган смс-хабарномаларни (шу жумладан "ICloud орқали") ёзма шаклга тенг хисобланади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.4. Агар кўрсатиб ўтилган келишмовчилик ва низолар музокаралар йули билан хал этилмаса, улар Ўзбекистон Республикасининг амалдаги қонунчилиги асосида Сотувчи худуди буйича Фуқаролик судда хал этилади.\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '10. ПОРЯДОК РАЗРЕШЕНИЯ СПОРОВ\n', fontSize: 10, bold: true },
                {
                  text: '10.1. Любые разногласия и споры, которые могут возникнуть в связи с настоящим Договором, стороны будут стараться решать путем переговоров.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.2. Срок рассмотрения официальных письменных претензий Покупателя составляет 7 (семь) календарных дней.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.3. Направление смс-уведомлений (в том числе через "ICloud") от Продавца на мобильное устройство по настоящему Договору считается соблюдением письменной формы.\n\n',
                  fontSize: 9,
                },
                {
                  text: '10.4. Если указанные разногласия и споры не могут быть разрешены путем переговоров, они будут решаться в гражданском суде согласно действующему законодательству Республики Узбекистан по месторасположению Продавца.\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // 11. YAKUNIY SHARTLAR
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '11. ЯКУНИЙ ШАРТЛАР\n', fontSize: 10, bold: true },
                {
                  text: '11.1. Ушбу Шартномаси Сотувчидан Товарни олган кундан бошлаб кучга киради ва Харидор ўз мажбуриятларни бажаргунча қадар амал қилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.2. Ушбу Шартномага кўшимча ва ўзгартиришлар киритиш Томонларнинг розилиги билан кўшимча келишув битими тузиш йули билан амалга оширилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.3. Ушбу Шартномада кўрсатилмаган холатлар, Узбекистон Республикасининг амалдаги конунчилиги оркали хал этилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.4 Томонларнинг манзиллари ва реквизитлари узгартирилган тақдирда, Томон маълумотларни узгартирган пайтдан бошлаб 3 (уч) кун ичида бошка Томонни хабардор қилиши шарт.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.5. Ушбу Шартнома бир хил юридик кучга эга булган икки нусхада тузилиб, Томонларнинг хар бирига бир нусхадан берилади.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.6. Харидор, Шартнома бўйича саволлар ёки мурожаатлар учун қуйидаги алоқа маълумотларидан фойдаланиши мумкин:\n',
                  fontSize: 9,
                },
                {
                  text: 'Телефон рақами: +998781134774\n',
                  fontSize: 9,
                },
                {
                  text: 'Электрон почта: oybarchineshimova61@gmail.com\n\n',
                  fontSize: 9,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '11. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ\n', fontSize: 10, bold: true },
                {
                  text: '11.1. Настоящий Договор вступает в силу с момента получения Товара от Продавца и действует до момента исполнения Покупателем своих обязательств.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.2. Любые изменения и дополнения к настоящему Договору вносятся путем заключения дополнительного соглашения по взаимному согласию Сторон.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.3. Во всем, что не предусмотрено настоящим Договором, стороны руководствуются действующим законодательством Республики Узбекистан.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.4. В случае изменения адресов и реквизитов Сторона обязана уведомить об этом другую Сторону в течение 3 (трех) дней с момента изменения сведений.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.5. Настоящий Договор составлен в двух экземплярах, имеющих одинаковую юридическую силу, по одному экземпляру для каждой из Сторон.\n\n',
                  fontSize: 9,
                },
                {
                  text: '11.6. Покупатель может воспользоваться следующими контактными данными для вопросов или обращений по Договору:\n',
                  fontSize: 9,
                },
                {
                  text: 'Телефон: +998781134774\n',
                  fontSize: 9,
                },
                {
                  text: 'Электронная почта: oybarchineshimova61@gmail.com\n\n',
                  fontSize: 9,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // ========== SAHIFA 2: Tomonlarning manzillari ==========
        { text: '', pageBreak: 'before' },
        {
          columns: [
            {
              width: '*',
              text: [
                { text: '10. ТОМОНЛАРНИНГ МАНЗИЛЛАРИ ВА РЕВИЗИТЛАРИ\n', fontSize: 10, bold: true },
                { text: 'СОТУВЧИ/ПРОДАВЕЦ\n', fontSize: 9, bold: true },
                { text: '«PROBOX GROUP CO» МЧЖ / ООО «PROBOX GROUP CO»\n', fontSize: 9 },
                { text: 'Манзил/Адрес:\n', fontSize: 9 },
                { text: 'Тошкент ш., Олмазор тумани, Нурафшон кўчаси, 1-уй. 12-хонадон.\n', fontSize: 9 },
                { text: 'Банк: АТБ «ASIA ALLIANCE BANK»\n', fontSize: 9 },
                { text: 'Банк коди/МФО: 01095\n', fontSize: 9 },
                { text: 'X/p/P/c: 20208000705125899001\n', fontSize: 9 },
                { text: 'СТИР/ИНН: 306737779\n\n', fontSize: 9 },
                { text: 'ХАРИДОР/ПОКУПАТЕЛЬ\n', fontSize: 9, bold: true },
                { text: `Ф.И.Ш./Ф.И.О: ${clientName || '_______________________'}\n`, fontSize: 9 },
                { text: 'Паспорт/id серияси ва рақами/Серия и номер паспорта/ id:\n', fontSize: 9 },
                { text: 'Манзил/Адрес:\n', fontSize: 9 },
                { text: `Тел.рақами/Тел.номер: ${clientPhone || '_______________________'}\n\n`, fontSize: 9 },
                { text: 'Шартнома 7 (етти) вароқдан иборат.\n', fontSize: 8 },
                {
                  text: `Муддатли тўлов асосида сотиш-харид қилиш шартномасига № ${leadId || '____'} ${year} йил "${day}" ${month} даги 1-сон Илова\n`,
                  fontSize: 8,
                },
              ],
            },
            {
              width: '*',
              text: [
                { text: '10. АДРЕСА И РЕКВИЗИТЫ СТОРОН\n', fontSize: 10, bold: true },
                { text: 'СОТУВЧИ/ПРОДАВЕЦ\n', fontSize: 9, bold: true },
                { text: '«PROBOX GROUP CO» МЧЖ / ООО «PROBOX GROUP CO»\n', fontSize: 9 },
                { text: 'Манзил/Адрес:\n', fontSize: 9 },
                { text: 'Тошкент ш., Олмазор тумани, Нурафшон кўчаси, 1-уй. 12-хонадон.\n', fontSize: 9 },
                { text: 'Банк: АТБ «ASIA ALLIANCE BANK»\n', fontSize: 9 },
                { text: 'Банк коди/МФО: 01095\n', fontSize: 9 },
                { text: 'X/p/P/c: 20208000705125899001\n', fontSize: 9 },
                { text: 'СТИР/ИНН: 306737779\n\n', fontSize: 9 },
                { text: 'ХАРИДОР/ПОКУПАТЕЛЬ\n', fontSize: 9, bold: true },
                { text: `Ф.И.Ш./Ф.И.О: ${clientName || '_______________________'}\n`, fontSize: 9 },
                { text: 'Паспорт/id серияси ва рақами/Серия и номер паспорта/ id:\n', fontSize: 9 },
                { text: 'Манзил/Адрес:\n', fontSize: 9 },
                { text: `Тел.рақами/Тел.номер: ${clientPhone || '_______________________'}\n\n`, fontSize: 9 },
                { text: 'Договор состоит из 7 (семи) страниц.\n', fontSize: 8 },
                {
                  text: `Приложение №1 к Договору купли-продажи на основе рассрочки № ${leadId || '____'} от "${day}" ${monthRu} ${year} г.\n`,
                  fontSize: 8,
                },
              ],
            },
          ],
          columnGap: 10,
        },

        // ========== SAHIFA 3: To'lov jadvali ==========
        { text: '', pageBreak: 'before' },
        {
          text: 'ТЎЛОВ ЖАДВАЛИ/ГРАФИК ПЛАТЯЖЕЙ',
          fontSize: 12,
          bold: true,
          alignment: 'center',
          margin: [0, 0, 0, 10],
        },
        {
          table: {
            headerRows: 1,
            widths: ['auto', '*', '*', '*'],
            body: [
              [
                { text: '№', bold: true, fillColor: '#f0f0f0' },
                { text: 'Сана/Дата', bold: true, fillColor: '#f0f0f0' },
                { text: 'Тўлов миқдори/Сумма оплаты (сум)', bold: true, fillColor: '#f0f0f0' },
                { text: 'Қолган миқдори/Остаток (сум)', bold: true, fillColor: '#f0f0f0' },
              ],
              // To'lov jadvali qatorlari
              ...Array.from({ length: 15 }, (_, i) => {
                const scheduleItem = paymentSchedule[i];
                if (scheduleItem) {
                  return [
                    scheduleItem.number.toString(),
                    scheduleItem.date,
                    scheduleItem.amount.toLocaleString('uz-UZ'),
                    scheduleItem.remaining.toLocaleString('uz-UZ'),
                  ];
                }
                // Agar ma'lumot yo'q bo'lsa, bo'sh qator
                return [
                  (i + 1).toString(),
                  '__________',
                  '__________',
                  '__________',
                ];
              }),
              [
                { text: 'ЖАМИ/ИТОГО:', bold: true, colSpan: 2 },
                '',
                totalPriceFormatted,
                '0',
              ],
            ],
          },
          layout: {
            hLineWidth: () => 0.3,
            vLineWidth: () => 0.3,
            paddingLeft: () => 2,
            paddingRight: () => 2,
            paddingTop: () => 2,
            paddingBottom: () => 2,
          },
        },
        { text: '\n' },
        {
          columns: [
            {
              width: '*',
              stack: [
                { text: 'СОТУВЧИ/ПРОДАВЕЦ\n', fontSize: 9, bold: true },
                { text: 'ООО «PROBOX GROUP CO»\n', fontSize: 9 },
                { text: 'Манзил: Тошкент ш., Олмазор тумани, Нурафшон кўчаси, 1-уй. 12-хонадон.\n', fontSize: 9 },
                { text: 'Банк: АТБ «ASIA ALLIANCE BANK»\n', fontSize: 9 },
                { text: 'Банк коди: 01095\n', fontSize: 9 },
                { text: 'X/p: 20208000705125899001\n', fontSize: 9 },
                { text: 'СТИР: 306737779\n\n', fontSize: 9 },
                { text: 'С о т у в ч и консультант: _________________\n', fontSize: 9 },
                { text: 'Имзо: ', fontSize: 9 },
                ...(signatureImage ? [
                  {
                    image: signatureImage,
                    width: 290,
                    height: 150,
                    margin: [0, 5, 0, 0],
                  },
                ] : [
                  { text: '_________________\n', fontSize: 9 },
                ]),
              ],
            },
            {
              width: '*',
              stack: [
                { text: 'ХАРИДОР/ПОКУПАТЕЛЬ\n', fontSize: 9, bold: true },
                { text: `Ф.И.Ш.: ${clientName || '_______________________'}\n\n`, fontSize: 9 },
                { text: 'Имзо: ', fontSize: 9 },
                ...(userSignature ? [
                  {
                    image: userSignature,
                    width: 150,
                    height: 60,
                    margin: [0, 2, 0, 0],
                  },
                ] : [
                  { text: '_________________\n', fontSize: 9 },
                ]),
              ],
            },
          ],
          columnGap: 10,
        },
      ],
    };

    // PDF yaratish va yuklab olish
    const fileName = `shartnoma-${leadId || 'unknown'}-${new Date().toISOString().slice(0, 10)}.pdf`;
    console.log('PDF fayl nomi:', fileName);
    
    pdfMake.createPdf(docDefinition).download(fileName);
    console.log('PDF fayl yuklab olindi');

    return true;
  } catch (error) {
    console.error('PDF fayl yaratishda xatolik:', error);
    throw error;
  }
};
